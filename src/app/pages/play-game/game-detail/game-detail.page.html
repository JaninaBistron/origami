<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button color=dark defaultHref="/" text="{{ 'General.back_button' | translate }}"></ion-back-button>
    </ion-buttons>
    <ion-title *ngIf="game">{{ game.name }}</ion-title>
    <ion-buttons slot="primary"></ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-card>
    <!-- <div #map class="map"></div> -->
    <ion-card-header>
      <ion-card-title *ngIf="game">{{ game.name }}</ion-card-title>
    </ion-card-header>
    <ion-card-content *ngIf="game">
      {{ game.tasks.length }} {{ game.tasks.length == 1 ? ['General.task' | translate ] : ['General.tasks' | translate
      ]}}
      <div>
        <span *ngFor="let task of game.tasks" class="dot" [class.nav]="task.category.includes('nav')"
          [class.theme]="task.category.includes('theme')" [class.free]="task.category.includes('free')"
          [class.info]="task.category.includes('info')"></span>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Enter name -->
  <ion-card *ngIf="userRole != 'contentAdmin' || isSingleMode">
    <!-- <ion-card> -->
    <ion-card-header>
      <ion-card-title> Enter your name
        <!-- <ion-icon name="information-circle"
          (click)="showPopover($event, 'Popover.gameConnectionInfo')">
        </ion-icon> -->
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-input placeholder="Player name (required)" [(ngModel)]="playerName"></ion-input>
    </ion-card-content>
  </ion-card>

  <!-- virtual environment -->
  <ion-card *ngIf="isVirtualWorld">
    <ion-card-header>
      <ion-card-title> {{ "PlayGame.gameConnection" | translate }}
        <ion-icon name="information-circle" (click)="showPopover($event, 'Popover.gameConnectionInfo')">
        </ion-icon>
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-input placeholder="{{ 'PlayGame.pl_EnterCode' | translate }}" [(ngModel)]="gameCode"></ion-input>
    </ion-card-content>
  </ion-card>

  <!-- only viewed by instructor -->
  <ion-card *ngIf="userRole=='contentAdmin' && !isSingleMode">
    <ion-card-header>
      <ion-card-title> Ask expected players to scan the below QR code to join the game.
      </ion-card-title>
    </ion-card-header>
    <ion-card-content style="display: flex; justify-content: center;">
      <ion-img style="width: 40%;" src="../../../../assets/temp/qrcode.png"></ion-img>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="userRole != 'contentAdmin' || isSingleMode">
    <ion-item lines="none">
      <ion-label text-wrap style="font-weight: bold;">{{ "PlayGame.shareDataAgreement" | translate }}</ion-label>
      <ion-checkbox slot="start" [(ngModel)]="shareData_cbox"></ion-checkbox>
    </ion-item>
  </ion-card>

  <ion-card *ngIf="userRole=='contentAdmin' && !isSingleMode">
    <ion-card-header>
      <ion-card-title> List of players:
      </ion-card-title>
    </ion-card-header>

    <ion-card-content *ngFor="let e of [].constructor(numPlayers); let i = index">

      <ion-label *ngIf="playersData[i]" style="font-weight: bold; font-size: large; color: black;">
        p{{ i+1 }}: {{playersData[i].name}} (
        <span
          [ngStyle]="{'color':playersData[i].connectionStatus=='connected'?'green':(playersData[i].connectionStatus=='disconnected'?'red':'blue')}">
          {{playersData[i].connectionStatus}}
        </span>
        )
      </ion-label>

      <ion-label *ngIf="!playersData[i]" style="font-weight: bold; font-size: large; color: black;">
        p{{ i+1 }}: ------ (
        <span style="color: blue;">
          not connected yet
        </span>
        )
      </ion-label>

    </ion-card-content>
  </ion-card>

</ion-content>

<ion-footer *ngIf="userRole!='contentAdmin'">
  <ion-toolbar>
    <ion-button expand="block" (click)="startGame()" [disabled]="!playerName || (!teacherCode && !isSingleMode)">{{
      "General.start" | translate }}</ion-button>
  </ion-toolbar>
</ion-footer>